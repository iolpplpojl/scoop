{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\admin\\\\Documents\\\\GitHub\\\\project\\\\scoop2\\\\scoop_front\\\\src\\\\component\\\\RightClickContainer.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useRef, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst RightClickContainer = ({\n  userId,\n  loggedInUserId,\n  addFriend,\n  deleteFriend,\n  children,\n  setHandleContextMenu\n}) => {\n  _s();\n  const [showMenu, setShowMenu] = useState(false);\n  const [menuPosition, setMenuPosition] = useState({\n    x: 0,\n    y: 0\n  });\n  const [selectedUserId, setSelectedUserId] = useState(null);\n  const [isFriend, setIsFriend] = useState(null);\n  const menuRef = useRef(null);\n  const REST = process.env.REACT_APP_RESTURL;\n\n  // 우클릭 이벤트 핸들러\n  async function handleContextMenu(event, id) {\n    if (String(id) === String(loggedInUserId)) return;\n    event.preventDefault();\n    setSelectedUserId(id);\n    setMenuPosition({\n      x: event.pageX,\n      y: event.pageY\n    });\n    try {\n      const res = await fetch(`https://${REST}/api/isfriend?userId=${id}&myId=${loggedInUserId}`);\n      const data = await res.json();\n      setIsFriend(data && (data.state === true || data.state === 1));\n    } catch (err) {\n      console.error(\"친구 상태 확인 실패\", err);\n      setIsFriend(false);\n    }\n    setShowMenu(true);\n  }\n\n  // 외부 클릭 시 닫기\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\n        closeMenu();\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  // 우클릭 핸들러 외부로 전달\n  useEffect(() => {\n    if (setHandleContextMenu) {\n      setHandleContextMenu(() => handleContextMenu);\n    }\n  }, [setHandleContextMenu]);\n  function closeMenu() {\n    setShowMenu(false);\n    setSelectedUserId(null);\n    setIsFriend(null);\n  }\n\n  // ✅ 1:1 채팅 함수 분리\n  const handleDirectMessage = async () => {\n    try {\n      const url = `https://${REST}/api/dm`;\n      const res = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sub: loggedInUserId,\n          to: selectedUserId\n        })\n      });\n      if (!res.ok) {\n        throw new Error(`서버 응답 에러: ${res.status}`);\n      }\n      const data = await res.json();\n      const chatroomId = data.chatroomId || data;\n      if (!chatroomId) {\n        alert(\"채팅방 ID를 찾을 수 없습니다.\");\n        return;\n      }\n      window.location.href = `/channel/@me/${chatroomId}`;\n    } catch (err) {\n      console.error(\"❌ 채팅방 이동 실패:\", err);\n      alert(\"1:1 채팅을 시작할 수 없습니다.\");\n    } finally {\n      closeMenu();\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: \"inline-block\",\n      width: \"100%\"\n    },\n    children: [children, showMenu && /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: menuRef,\n      style: {\n        position: \"absolute\",\n        top: menuPosition.y,\n        left: menuPosition.x,\n        background: \"#fff\",\n        border: \"1px solid #ccc\",\n        padding: \"5px\",\n        boxShadow: \"2px 2px 5px rgba(0,0,0,0.2)\",\n        zIndex: 999\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => alert(\"정보보기\"),\n        children: \"\\uC815\\uBCF4\\uBCF4\\uAE30\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 11\n      }, this), isFriend ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDirectMessage,\n          children: \"1:1 \\uCC44\\uD305\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: async () => {\n            await deleteFriend(selectedUserId, loggedInUserId);\n            closeMenu();\n          },\n          children: \"\\uCE5C\\uAD6C \\uC0AD\\uC81C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          addFriend(selectedUserId);\n          closeMenu();\n        },\n        children: \"\\uCE5C\\uAD6C \\uCD94\\uAC00\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n};\n_s(RightClickContainer, \"38/niEHLwSEL2IgxV0GCPpy/kY4=\");\n_c = RightClickContainer;\nexport default RightClickContainer;\nvar _c;\n$RefreshReg$(_c, \"RightClickContainer\");","map":{"version":3,"names":["useState","useRef","useEffect","jsxDEV","_jsxDEV","Fragment","_Fragment","RightClickContainer","userId","loggedInUserId","addFriend","deleteFriend","children","setHandleContextMenu","_s","showMenu","setShowMenu","menuPosition","setMenuPosition","x","y","selectedUserId","setSelectedUserId","isFriend","setIsFriend","menuRef","REST","process","env","REACT_APP_RESTURL","handleContextMenu","event","id","String","preventDefault","pageX","pageY","res","fetch","data","json","state","err","console","error","handleClickOutside","current","contains","target","closeMenu","document","addEventListener","removeEventListener","handleDirectMessage","url","method","headers","body","JSON","stringify","sub","to","ok","Error","status","chatroomId","alert","window","location","href","style","display","width","ref","position","top","left","background","border","padding","boxShadow","zIndex","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/admin/Documents/GitHub/project/scoop2/scoop_front/src/component/RightClickContainer.jsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\r\n\r\nconst RightClickContainer = ({\r\n  userId,\r\n  loggedInUserId,\r\n  addFriend,\r\n  deleteFriend,\r\n  children,\r\n  setHandleContextMenu,\r\n}) => {\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState({ x: 0, y: 0 });\r\n  const [selectedUserId, setSelectedUserId] = useState(null);\r\n  const [isFriend, setIsFriend] = useState(null);\r\n  const menuRef = useRef(null);\r\n  const REST = process.env.REACT_APP_RESTURL;\r\n\r\n  // 우클릭 이벤트 핸들러\r\n  async function handleContextMenu(event, id) {\r\n    if (String(id) === String(loggedInUserId)) return;\r\n\r\n    event.preventDefault();\r\n    setSelectedUserId(id);\r\n    setMenuPosition({ x: event.pageX, y: event.pageY });\r\n\r\n    try {\r\n      const res = await fetch(\r\n        `https://${REST}/api/isfriend?userId=${id}&myId=${loggedInUserId}`\r\n      );\r\n      const data = await res.json();\r\n      setIsFriend(data && (data.state === true || data.state === 1));\r\n    } catch (err) {\r\n      console.error(\"친구 상태 확인 실패\", err);\r\n      setIsFriend(false);\r\n    }\r\n\r\n    setShowMenu(true);\r\n  }\r\n\r\n  // 외부 클릭 시 닫기\r\n  useEffect(() => {\r\n    function handleClickOutside(event) {\r\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\r\n        closeMenu();\r\n      }\r\n    }\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  // 우클릭 핸들러 외부로 전달\r\n  useEffect(() => {\r\n    if (setHandleContextMenu) {\r\n      setHandleContextMenu(() => handleContextMenu);\r\n    }\r\n  }, [setHandleContextMenu]);\r\n\r\n  function closeMenu() {\r\n    setShowMenu(false);\r\n    setSelectedUserId(null);\r\n    setIsFriend(null);\r\n  }\r\n\r\n  // ✅ 1:1 채팅 함수 분리\r\n  const handleDirectMessage = async () => {\r\n    try {\r\n      const url = `https://${REST}/api/dm`;\r\n      const res = await fetch(url, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          sub: loggedInUserId,\r\n          to: selectedUserId,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        throw new Error(`서버 응답 에러: ${res.status}`);\r\n      }\r\n\r\n      const data = await res.json();\r\n      const chatroomId = data.chatroomId || data;\r\n\r\n      if (!chatroomId) {\r\n        alert(\"채팅방 ID를 찾을 수 없습니다.\");\r\n        return;\r\n      }\r\n\r\n      window.location.href = `/channel/@me/${chatroomId}`;\r\n    } catch (err) {\r\n      console.error(\"❌ 채팅방 이동 실패:\", err);\r\n      alert(\"1:1 채팅을 시작할 수 없습니다.\");\r\n    } finally {\r\n      closeMenu();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: \"inline-block\", width: \"100%\" }}>\r\n      {children}\r\n\r\n      {showMenu && (\r\n        <div\r\n          ref={menuRef}\r\n          style={{\r\n            position: \"absolute\",\r\n            top: menuPosition.y,\r\n            left: menuPosition.x,\r\n            background: \"#fff\",\r\n            border: \"1px solid #ccc\",\r\n            padding: \"5px\",\r\n            boxShadow: \"2px 2px 5px rgba(0,0,0,0.2)\",\r\n            zIndex: 999,\r\n          }}\r\n        >\r\n          <button onClick={() => alert(\"정보보기\")}>정보보기</button>\r\n          {isFriend ? (\r\n            <>\r\n              <button onClick={handleDirectMessage}>1:1 채팅</button>\r\n              <button\r\n                onClick={async () => {\r\n                  await deleteFriend(selectedUserId, loggedInUserId);\r\n                  closeMenu();\r\n                }}\r\n              >\r\n                친구 삭제\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <button\r\n              onClick={() => {\r\n                addFriend(selectedUserId);\r\n                closeMenu();\r\n              }}\r\n            >\r\n              친구 추가\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RightClickContainer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}